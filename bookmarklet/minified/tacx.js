javascript:(function()%7Bclass%20pelotonLink%20%7Bconstructor()%20%7B%2F%2F%20constantsthis.trainerBuffer%20%3D%2010%3B%20%2F%2F%20minimum%20seconds%20between%20pushes%20to%20trainer%2F%2F%20state%20variablesthis.rideId%20%3D%20window.location.pathname.split('%2F').pop()%3Bthis.lastTrainerUpdate%20%3D%200%3Bthis.rideDetails%20%3D%20%7B%7D%3Bthis.uiTimecode%20%3D%200%3Bthis.trainerTimecode%20%3D%200%3Bthis.classDuration%20%3D%200%3Bthis.pedalingStartOffset%20%3D%200%3Bthis.lastTrainerPush%20%3D%200%3Bthis.bluetoothAddress%20%3D%20''%3Bthis.bluetoothName%3Bthis.trainerBusy%20%3D%20false%3Bthis.injectCSS()%3Bthis.injectUI()%3Bthis.getBluetoothTrainer()%3B%7DinjectCSS()%20%7Bconst%20style%20%3D%20document.createElement('style')%3Bstyle.style%20%3D%20'text%2Fcss'%3Bstyle.innerHTML%20%3D%20'%23overlayContainer%20%7B%20position%3A%20absolute%3B%20display%3A%20flex%3B%20flex-wrap%3A%20wrap%3B%20bottom%3A%20180px%3B%20left%3A%2040px%3B%20height%3A%20300px%3B%20max-width%3A%20100px%3B%20%7D%20'%3Bstyle.innerHTML%20%2B%3D%20'.statsContainer%20%7B%20font-size%3A%2030px%3B%20border-radius%3A%205px%3B%20opacity%3A%200.3%3B%20background-color%3A%20%23EFEFEF%3B%20margin%3A%2010px%3B%20color%3A%20%23444%3B%20padding%3A%2010px%3B%20%7D%20'%3Bstyle.innerHTML%20%2B%3D%20'.descriptor%20%7B%20font-size%3A%2015px%3B%20padding-right%3A%2030px%3B%20min-width%3A%20110px%3B%20%7D%20'%3Bstyle.innerHTML%20%2B%3D%20'.lineItem%20%7B%20display%3A%20flex%3B%20margin-top%3A%2010px%3B%20width%3A%20300px%3B%20justify-content%3A%20right%3B%20%7D%20'%3Bstyle.innerHTML%20%2B%3D%20'.metricValue%20%7B%20min-width%3A%20150px%20%7D%20'%3Bstyle.innerHTML%20%2B%3D%20'%23cadresistprogress%20%7B%20width%3A%200%25%3B%20transition%3A%20990ms%20linear%3B%20height%3A%202px%3B%20background-color%3A%20%23F00%3B%20margin-top%3A%2020px%3B%20%7D%20'%3Bdocument.getElementsByTagName('head')%5B0%5D.appendChild(style)%3B%7DinjectUI()%20%7Bconst%20outputDiv%20%3D%20document.createElement('div')%3BoutputDiv.id%20%3D%20'overlayContainer'%3BoutputDiv.innerHTML%20%3D%60%3Cdiv%20id%3D%22targetMetrics%22%20class%3D%22statsContainer%22%3E%3Cdiv%20class%3D%22lineItem%22%3E%3Cdiv%20class%3D%22descriptor%22%3Eresistance%20(peloton)%3C%2Fdiv%3E%3Cdiv%20id%3D%22pReistanceValue%22%20class%3D%22metricValue%22%3E0%3C%2Fdiv%3E%3C%2Fdiv%3E%3Cdiv%20class%3D%22lineItem%22%3E%3Cdiv%20class%3D%22descriptor%22%3Eresistance%20(adj%20%25)%3C%2Fdiv%3E%3Cdiv%20id%3D%22tReistanceValue%22%20class%3D%22metricValue%22%3E0%3C%2Fdiv%3E%3C%2Fdiv%3E%3Cdiv%20class%3D%22lineItem%22%3E%3Cdiv%20class%3D%22descriptor%22%3Ecadence%3C%2Fdiv%3E%3Cdiv%20id%3D%22cadenceValue%22%20class%3D%22metricValue%22%3E0%3C%2Fdiv%3E%3C%2Fdiv%3E%3Cdiv%20id%3D%22cadresistprogress%22%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%60%3BoutputDiv.innerHTML%20%2B%3D%60%3Cdiv%20id%3D%22trainerOutput%22%20class%3D%22statsContainer%22%3E%3Cdiv%20class%3D%22lineItem%22%3E%3Cdiv%20class%3D%22descriptor%22%3Etrainer%3A%3C%2Fdiv%3E%3Cdiv%20class%3D%22descriptor%22%20id%3D%22trainerName%22%3E%24%7Bthis.bluetoothName%20%7C%7C%20'connecting...'%7D%3C%2Fdiv%3E%3C%2Fdiv%3E%3Cdiv%20class%3D%22lineItem%22%3E%3Cdiv%20class%3D%22descriptor%22%3Ecadence%3C%2Fdiv%3E%3Cdiv%20id%3D%22actualCadenceValue%22%20class%3D%22metricValue%22%3E0%3C%2Fdiv%3E%3C%2Fdiv%3E%3Cdiv%20class%3D%22lineItem%22%3E%3Cdiv%20class%3D%22descriptor%22%3Epower%3C%2Fdiv%3E%3Cdiv%20id%3D%22powerValue%22%20class%3D%22metricValue%22%3E0%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%60%3Bdocument.querySelector(%22div%5Bclass%3D'jw-wrapper%20jw-reset'%5D%22).after(outputDiv)%3B%7Dasync%20getRideDetails()%20%7Bconst%20response%20%3D%20await%20fetch(%60https%3A%2F%2Fapi.onepeloton.com%2Fapi%2Fride%2F%24%7Bthis.rideId%7D%2Fdetails%3Fstream_source%3Dmultichannel%60%2C%7B%22headers%22%3A%20%7B%22accept%22%3A%20%22application%2Fjson%2C%20text%2Fplain%2C%20*%2F*%22%2C%22accept-language%22%3A%20%22en-US%22%2C%22peloton-platform%22%3A%20%22web%22%2C%22sec-fetch-dest%22%3A%20%22empty%22%2C%22sec-fetch-mode%22%3A%20%22cors%22%2C%22sec-fetch-site%22%3A%20%22same-site%22%2C%22x-requested-with%22%3A%20%22XmlHttpRequest%22%7D%2C%22referrer%22%3A%20%60https%3A%2F%2Fmembers.onepeloton.com%2Fclasses%2Fplayer%2F%24%7Bthis.rideId%7D%60%2C%22referrerPolicy%22%3A%20%22no-referrer-when-downgrade%22%2C%22body%22%3A%20null%2C%22method%22%3A%20%22GET%22%2C%22mode%22%3A%20%22cors%22%2C%22credentials%22%3A%20%22include%22%7D)%3Bthis.rideDetails%20%3D%20await%20response.json()%3Bthis.classDuration%20%3D%20Number(this.rideDetails.ride.duration)%3Bthis.pedalingStartOffset%20%3D%20Number(this.rideDetails.ride.pedaling_start_offset)%3Breturn%20this.rideDetails%3B%7Dasync%20getBluetoothTrainer()%20%7Bthis.trainerBusy%20%3D%20true%3Bconst%20response%20%3D%20await%20fetch(%22http%3A%2F%2F127.0.0.1%3A8000%2Fdiscover%22)%3Bconst%20devices%20%3D%20await%20response.json()%3Bthis.trainerBusy%20%3D%20false%3Bthis.bluetoothAddress%20%3D%20devices.find(dev%20%3D%3E%20dev.name.toLowerCase().includes('tacx')).address%3Bthis.bluetoothName%20%3D%20devices.find(dev%20%3D%3E%20dev.name.toLowerCase().includes('tacx')).name%3Bdocument.getElementById('trainerName').innerHTML%20%3D%20this.bluetoothName%3Breturn%20this.bluetoothAddress%3B%7Dasync%20setTrainerResistance(bluetoothAddress%2C%20resistance%2C%20timecode)%20%7Bif%20(this.lastTrainerPush%20%2B%20this.trainerBuffer%20%3E%3D%20timecode)%20return%3Bthis.lastTrainerPush%20%3D%20timecode%3Bconsole.log(%60Setting%20resistance%20of%20%24%7Bresistance%7D%20for%20trainer%20at%20%24%7BbluetoothAddress%7D%60)%3Btry%20%7Bif%20(this.trainerBusy)%20return%3Bthis.trainerBusy%20%3D%20true%3Bconst%20response%20%3D%20await%20fetch(%60http%3A%2F%2F127.0.0.1%3A8000%2Ftrainer%2F%24%7BbluetoothAddress%7D%2Fresistance%2F%24%7Bresistance%7D%60%2C%20%7B%20method%3A%20'POST'%20%7D)%3Bconst%20stats%20%3D%20await%20response.json()%3Bthis.trainerBusy%20%3D%20false%3Bif%20(typeof%20stats.instantaneous_cadence%20!%3D%3D%20%22undefined%22)%20document.getElementById('actualCadenceValue').innerHTML%20%3D%20%60%24%7Bstats.instantaneous_cadence%7D%20rpm%60%3Bif%20(typeof%20stats.instantaneous_power%20!%3D%3D%20%22undefined%22)%20document.getElementById('powerValue').innerHTML%20%3D%20%60%24%7Bstats.instantaneous_power%7D%20watts%60%3Bconsole.log(%60success%20setting%20trainer%20resistance%20to%20%24%7Bresistance%7D%60)%3B%7D%20catch%20(e)%20%7Bconsole.error(%60failed%20to%20set%20trainer%20resistance%20to%20%24%7Bresistance%7D%60)%3B%7D%7DconvertResistance(min%2C%20max)%20%7Breturn%20%7Bpercent%3A%20%7Bmin%3A%20Math.floor((min%20%2F%20200)%20*%20100)%2Cmax%3A%20Math.floor((max%20%2F%20200)%20*%20100)%2Cavg%3A%20Math.floor((((min%20%2B%20max)%20%2F%202)%20%2F%20200)%20*%20100)%2C%7D%2C%7D%7DupdateUiOutput(cue%2C%20timecode)%20%7Bconst%20trainer%20%3D%20this.convertResistance(cue.resistance_range.lower%2C%20cue.resistance_range.upper)%3Bdocument.getElementById('pReistanceValue').innerHTML%20%3D%20%60%24%7Bcue.resistance_range.lower%7D%20-%20%24%7Bcue.resistance_range.upper%7D%60%3Bdocument.getElementById('cadenceValue').innerHTML%20%3D%20%60%24%7Bcue.cadence_range.lower%7D%20-%20%24%7Bcue.cadence_range.upper%7D%20rpm%60%3Bdocument.getElementById('tReistanceValue').innerHTML%20%3D%20%60%24%7Btrainer.percent.min%7D%20-%20%24%7Btrainer.percent.max%7D%20%25%60%3Blet%20cadResisProgressDiv%20%3D%20document.getElementById('cadresistprogress')%3Bif%20(timecode%20%3D%3D%20Number(cue.offsets.start))%20%7BcadResisProgressDiv.style.transition%20%3D%20%22none%22%3BcadResisProgressDiv.style.width%20%3D%20%220%25%22%3B%7D%20else%20%7BcadResisProgressDiv.style.transition%20%3D%20%22990ms%20linear%22%3BcadResisProgressDiv.style.width%20%3D%20Math.round((((timecode)%20-%20cue.offsets.start)%20%2F%20(cue.offsets.end%20-%20cue.offsets.start))%20*%20100)%20%2B%20%22%25%22%3B%7D%7DfindMatchingMetricOffset(timecode)%20%7Bconst%20cues%20%3D%20this.rideDetails.instructor_cues%3Breturn%20cues.find(c%20%3D%3E%20Number(c.offsets.start)%20%3C%3D%20timecode%20%26%26%20Number(c.offsets.end)%20%3E%3D%20timecode)%3B%7DhandlePageUpdate(_mutations)%20%7Blet%20timestamp%20%3D%20document.querySelector(%22p%5Bdata-test-id%3D'time-to-complete'%5D%22)%3Bif%20(!timestamp)%20return%3B%20%2F%2F%20maybe%20throw%20up%20an%20UI%20update%20heretimestamp%20%3D%20timestamp.innerHTML.split(%22%3A%22)%3Bif%20(timestamp.length%20!%3D%202)%20return%3Bthis.uiTimecode%20%3D%20(this.classDuration%20-%20(Number(timestamp%5B0%5D)%20*%2060%20%2B%20Number(timestamp%5B1%5D)))%2B%20Number(this.pedalingStartOffset)%3Bthis.updateUiOutput(this.findMatchingMetricOffset(this.uiTimecode)%2C%20this.uiTimecode)%3Bthis.trainerTimecode%20%3D%20this.uiTimecode%20%2B%2020%3Bconst%20%7B%20resistance_range%20%7D%20%3D%20this.findMatchingMetricOffset(this.trainerTimecode)%3Bthis.setTrainerResistance(this.bluetoothAddress%2C%20resistance_range.lower%2C%20this.uiTimecode)%3B%7D%7Dconst%20start%20%3D%20async%20()%20%3D%3E%20%7Bconst%20link%20%3D%20new%20pelotonLink()%3Bawait%20link.getRideDetails()%3Bconst%20mPar%20%3D%20document.querySelector(%22div%5Bclass%3D'player-overlay-wrapper'%5D%22)%3Bconst%20options%20%3D%20%7Battributes%3A%20true%2CchildList%3A%20true%2Csubtree%3A%20true%2CcharacterData%3A%20true%7D%3Bconst%20notifyDomUpdate%20%3D%20(m)%20%3D%3E%20link.handlePageUpdate(m)%3Bconst%20observer%20%3D%20new%20MutationObserver(notifyDomUpdate)%3Bobserver.observe(mPar%2C%20options)%3B%7D%2F%2F%20TODO%3A%20this%20is%20super%20janky%2C%20find%20a%20better%20way%20to%2F%2F%20detect%20that%20the%20player%20is%20loadedsetTimeout(()%20%3D%3E%20start()%2C%2010000)%7D)()